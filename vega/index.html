<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=640,user-scalable=no">
  <meta name="format-detection" content="telephone=no"/>
  <title>进击的牛郎</title>
  
  <style>
    *{padding:0;margin:0;font-family:'微软雅黑'}
    html,body{height:1040px;}
    #loadingPage{
      width:100%;
      height:100%;
    }
    #loadingIcon{
      position:absolute;
      left:50%;
      top:30%;
      transition:all .8s 0s ease-out;
    }
    #loadingText{
      display:none;
    }
    #loadingBar{
      position:absolute;
      left:50%;
      top:50%;
      width:72%;
      height:4px;
    }
    #loadingBarInner{
      width:0;
      height:100%;
      background-color:#126290;
    }
    /*-----*/
    #gameBox{
      width:100%;
      height:100%;
    }
    .game-page{
      display:none;
      position:relative;
      width:100%;
      height:100%;
      overflow:hidden;
    }
    .game-page-current{
      display:block;
    }
    /*page2*/
    #bg{
      -webkit-animation:move 20s linear  0s infinite;
      animation:move 20s linear  0s infinite;
    }
    @-webkit-keyframes  move{
      0%{background-position:0 0;}
      100%{background-position:-640px 0}
    }
    @keyframes move{
      0%{background-position:0 0;}
      100%{background-position:-640px 0}
    }
    /*page3*/
    #tudi{
      display:none;
      width:258px;
      height:218px;
      transform:translate3d(-50%,-100%,0) matrix(1.2, 0, 0, 1.2, 470, 700);
      -webkit-animation:fly 2s ease-in-out  0s infinite;
      animation:fly 2s ease-in-out  0s infinite;
    }
    @-webkit-keyframes fly{
      0%{transform:translate3d(-50%,-100%,0) matrix(1.2, 0, 0, 1.2, 470, 700);}
      50%{transform:translate3d(-50%,-80%,0) matrix(1.2, 0, 0, 1.2, 470, 700);}
      100%{transform:translate3d(-50%,-100%,0) matrix(1.2, 0, 0, 1.2, 470, 700);}
    }
    @keyframes fly{
      0%{transform:translate3d(-50%,-100%,0) matrix(1.2, 0, 0, 1.2, 470, 700);}
      50%{transform:translate3d(-50%,-80%,0) matrix(1.2, 0, 0, 1.2, 470, 700);}
      100%{transform:translate3d(-50%,-100%,0) matrix(1.2, 0, 0, 1.2, 470, 700);}
    }
    /*page4*/
    #nlzn{
      position:absolute;
      width:300px;
      height:300px;
      transform:translate3d(-50%, -100%, 0) matrix(1, 0, 0, 1, 320, 700);
      -webkit-animation:tuanju 1.6s ease-in-out  0s infinite;
      animation:tuanju 1.6s ease-in-out  0s infinite;
    }
    @-webkit-keyframes tuanju{
      0%{transform:translate3d(-50%, -100%, 0) matrix(1, 0, 0, 1, 320, 700);}
      50%{transform:translate3d(-50%,-96%,0) matrix(1, 0, 0, 1, 320, 700);}
      100%{transform:translate3d(-50%, -100%, 0) matrix(1, 0, 0, 1, 320, 700);}
    }
    @keyframes tuanju{
      0%{transform:translate3d(-50%, -100%, 0) matrix(1, 0, 0, 1, 320, 700);}
      50%{transform:translate3d(-50%,-96%,0) matrix(1, 0, 0, 1, 320, 700);}
      100%{transform:translate3d(-50%, -100%, 0) matrix(1, 0, 0, 1, 320, 700);}
    }
    .res3{
      position:absolute;
      left:7%;
      top:16%;
      width:86%;
      line-height:50px;
      font-size:30px;
      color:#FFF;
      opacity:0;
    }
    
  </style>
</head>
<body>
  <div id="loadingPage">
    <img id="loadingIcon" src="./images/loading.gif" alt="loading">
    <div id="loadingText">0</div>
    <div id="loadingBar">
      <div id="loadingBarInner"></div>
    </div>
  </div>
  <div id="gameBox" style="display:none;">

    <div class="game-page game-page-current">
      <img src="./images/首页背景.jpg" style="position:absolute;" alt="">
      <img src="./images/title.png" id="title" style="position:absolute;transform:translate3d(-50%, -300%, 0) matrix(1, 0, 0, 1, 320, 410);" alt="">
      <img src="./images/云朵1.png" id="yd1" style="position:absolute;transform:translate3d(-50%, -100%, 0) matrix(1, 0, 0, 1, 812, 876);" alt="">
      <img src="./images/织女1.png" id="zn1" style="position:absolute;transform:translate3d(-50%, -100%, 0) matrix(1, 0, 0, 1, 840, 834);" alt="">
      <img src="./images/牛郎1.png" id="nl1" style="position:absolute;transform:translate3d(-160%, -100%, 0) matrix(1, 0, 0, 1, 190, 1040);" alt="">
      <img src="./images/游戏规则.png" id="yxgzBtn" class="btn" style="display:none;opacity:0;position:absolute;transform:translate3d(-50%, -100%, 0) matrix(1, 0, 0, 1, 320, 880);" alt="">
      <img src="./images/开始游戏.png" id="ksyxBtn" class="btn" style="display:none;opacity:0;position:absolute;transform:translate3d(-50%, -100%, 0) matrix(1, 0, 0, 1, 320, 960);" alt="">
      <img src="./images/rules.png" id="gameRule" style="display:none;position:absolute;transform:translate3d(-50%, -100%, 0) matrix(1, 0, 0, 1, 320, 990);" alt="">
      <img src="./images/在下知晓.png" id="zxzxBtn" class="btn" style="display:none;position:absolute;transform:translate3d(-50%, -100%, 0) matrix(1, 0, 0, 1, 320, 900);" alt="">
    </div>

    <div class="game-page" id="game">
      <div id="bg" style="position:absolute;left:0;top:0;width:100%;height:100%;background:url(./images/后退背景.jpg) repeat-x;"></div>
      <img src="./images/陨石.png" id="stone" style="position:absolute;left:260px;top:-100px;" alt="">
      <img src="./images/小山.png" id="hail1" style="position:absolute;left:640px;bottom:-10px;" alt="">
      <img src="./images/大山.png" id="hail2" style="position:absolute;left:650px;bottom:-10px;" alt="">
      <img src="./images/1.png" id="role" style="position:absolute;left:20px;top:300px;" alt="">
      <img src="./images/云层0.png" id="cloud1" style="position:absolute;left:640px;top:450px;" alt="">
      <img src="./images/云层0.png" id="cloud2" style="position:absolute;left:640px;top:700px;" alt="">
      <img src="./images/距离.png" style="position:absolute;transform:translate3d(-50%, -100%, 0) matrix(1, 0, 0, 1, 470, 110);" alt="">
      <div id="jl" style="position:absolute;right:0;top:50px;width:230px;height:40px;font-size:30px;color:#FFF;">共飞行了0米</div>
    </div>

    <div class="game-page">
      <img src="./images/首页背景.jpg" style="position:absolute;" alt="">
      <div style="position:absolute;top:20%;width:100%;font-size:40px;color:#FFF;font-weight:bold;text-align:center;letter-spacing:6px;">
        <div class="res1" style="height:80px;line-height:80px;opacity:0;">您一共飞行了&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;米</div>
        <div class="res1" style="position:absolute;left:54%;top:-10%;width:200px;font-size:80px;color:#FF0;opacity:0;">28</div>
        <div class="res2" style="height:80px;line-height:80px;opacity:0;">很遗憾您没有追上织女</div>
      </div>
      <img src="./images/织女2.png" id="zn2" style="position:absolute;transform:translate3d(0, -100%, 0) matrix(0.4, 0, 0, 0.4, 530, 840);opacity:0;" alt="">
      <img src="./images/牛郎2.png" id="nl2" style="position:absolute;transform:translate3d(-120%, -100%, 0) matrix(0.5, 0, 0, 0.5, 190, 1070);opacity:0;" alt="">
      <img src="./images/告知天下.png" class="gztxBtn btn" style="display:none;opacity:0;position:absolute;transform:translate3d(-50%, -100%, 0) matrix(1, 0, 0, 1, 320, 880);" alt="">
      <img src="./images/重新来过.png" class="cxlgBtn btn" style="display:none;opacity:0;position:absolute;transform:translate3d(-50%, -100%, 0) matrix(1, 0, 0, 1, 320, 960);" alt="">
      <div id="tudi" class="tc" style="position:absolute;opacity:0;">
        <img src="./images/土地爷.png" style="position:absolute;transform:translate3d(0, 0, 0) matrix(0.4, 0, 0, 0.4, 24, -90);" alt="">
        <img src="./images/云层0.png" style="position:absolute;transform:translate3d(0, 0, 0) matrix(1, 0, 0, 1, 78, 114);" alt="">
        <img src="./images/点我.png" style="position:absolute;transform:translate3d(0, 0, 0) matrix(0.6, 0, 0, 0.6, -40, 24);" alt="">
      </div>
      <div id="tudijianghuw" style="position:absolute;display:none;">
        <img src="./images/土地讲话.png" style="position:absolute;transform:translate3d(-50%, -100%, 0) matrix(1, 0, 0, 1, 320, 990);" alt="">
        <img src="./images/土地爷.png" id="tdy" class="btn" style="position:absolute;transform:translate3d(-50%, -100%, 0) matrix(1, 0, 0, 1, 420, 390);" alt="">
        <img src="./images/土地的话.png" style="position:absolute;transform:translate3d(-50%, -100%, 0) matrix(1, 0, 0, 1, 280, 760);" alt="">
        <img src="./images/奉上秘宝.png" id="fsmbBtn" class="btn" style="position:absolute;transform:translate3d(-50%, -100%, 0) matrix(1, 0, 0, 1, 320, 900);" alt="">
      </div>
      <img src="./images/转发.png" class="share" style="display:none;position:absolute;transform:translate3d(0, 0, 0) matrix(1, 0, 0, 1, 0, 0);" alt="">
    </div>
      
    <div class="game-page">
      <img src="./images/首页背景.jpg" style="position:absolute;" alt="">
      <div class="res3">
        你顺利的消去了王母娘娘 的怒火，织女也因此得救，恭喜你成功解救了织女！
      </div>
      <div id="nlzn">
        <img src="./images/云层0.png" style="position:absolute;transform:translate3d(50%, 0, 0) matrix(1.8, 0, 0, 1.8, 0, 220);" alt="">
        <img src="./images/牛郎织女4.png" style="position:absolute;transform:translate3d(-50%, -50%, 0) matrix(0.08, 0, 0, 0.08, 154, 110);" alt="">
      </div>
      <img src="./images/我也要秘宝.png" id="wyymbBtn" class="btn" style="position:absolute;transform:translate3d(-50%, -100%, 0) matrix(1, 0, 0, 1, 164, 880);" alt="">
      <img src="./images/告知天下.png" class="gztxBtn btn" style="position:absolute;transform:translate3d(-50%, -100%, 0) matrix(1, 0, 0, 1, 476, 880);" alt="">
      <img src="./images/重新来过.png" class="cxlgBtn btn" style="position:absolute;transform:translate3d(-50%, -100%, 0) matrix(1, 0, 0, 1, 320, 960);" alt="">
      <img src="./images/转发.png" class="share" style="display:none;position:absolute;transform:translate3d(0, 0, 0) matrix(1, 0, 0, 1, 0, 0);" alt="">
    </div>


    <audio id="music" src="./bgm/index.mp3"></audio>
    <audio id="btn-msc" src="./bgm/按钮.mp3"></audio>
    <audio id="tc-msc" src="./bgm/弹窗.mp3"></audio>
    <audio id="hj-msc" src="./bgm/获救.mp3"></audio>
    <audio id="ys-msc" src="./bgm/陨石.mp3"></audio>
    <audio id="scb-msc" src="./bgm/扇翅膀.mp3"></audio>
    <audio id="zdnd-msc" src="./bgm/砸到脑袋.mp3"></audio>
    <audio id="zl-msc" src="./bgm/坠落.mp3"></audio>
  </div>

  <script src="./js/jweixin-1.3.0.js"></script>
  <script src="./js/zepto.min.js"></script>
  <script src="./js/zepto.touch.js"></script>
  <script src="./js/zepto.fx.js"></script>
  <script>
    var timeStamp = new Date().getTime();
    var title = '进击的牛郎，快来追你的小仙女吧！';
    var desc = '骑着喜鹊是什么感觉，追着心动的人儿时什么滋味，有人阻碍你们，你是否会被现实打败？';
    var link = 'https://dishuz.github.io/CheapCode/vaga';
    var imgUrl = './images/牛郎织女4.png';
    wx.config({
      debug: true,
      appId: 'wxa2a9ed635f3dd9de',
      timestamp: timeStamp,
      nonceStr: 'hello world',
      jsApiList: [
        'onMenuShareTimeline',
        'onMenuShareAppMessage',
        'onMenuShareQQ',
        'onMenuShareWeibo',
        'onMenuShareQZone'
      ]
    })
    wx.ready(function(){
      wx.onMenuShareTimeline({
        title: title,
        desc: desc,
        link: link,
        imgUrl : imgUrl,
        success: function(){
          console.log('成功');
        }
      })
    })

    var doc = document,
        winW = window.innerWidth,
        winH = window.innerHeight;
    var loadingDone = false;
    var loadingIcon = doc.getElementById('loadingIcon');
    if(loadingIcon){
      loadingIcon.style.transform='translate(-50%, -50%) scale(' + winW/640 + ',' + winW/640 + ')';
      loadingIcon.style.msTransform='translate(-50%, -50%) scale(' + winW/640 + ',' + winW/640 + ')';
      loadingIcon.style.WebkitTransform='translate(-50%, -50%) scale(' + winW/640 + ',' + winW/640 + ')';
    }

    var loadingBar = doc.getElementById('loadingBar');
    if(loadingBar){
      loadingBar.style.transform='translate(-50%, -50%) scale(' + winW/640 + ',' + winW/640 + ')';
      loadingBar.style.msTransform='translate(-50%, -50%) scale(' + winW/640 + ',' + winW/640 + ')';
      loadingBar.style.WebkitTransform='translate(-50%, -50%) scale(' + winW/640 + ',' + winW/640 + ')';
    }

    var loadingPage = doc.getElementById('loadingPage');
    var loadingText = doc.getElementById('loadingText');
    var bar = doc.getElementById('loadingBarInner');
    var p = loadingText.innerHTML;


    //---------//
    
    var gameBox = doc.getElementById('gameBox');

    function gameView(){
      var oRole = doc.getElementById('role');
      var bgm = doc.getElementById('music');
      var btnMsc = doc.getElementById('btn-msc');
      var tcMsc = doc.getElementById('tc-msc');
      var ysMsc = doc.getElementById('ys-msc');
      var scbMsc = doc.getElementById('scb-msc');
      var hjBgm = doc.getElementById('hj-msc');
      var zdndBgm = doc.getElementById('zdnd-msc');
      var zlBgm = doc.getElementById('zl-msc');
      var pages = $('.game-page');
      var one = true;
      var timer = null;//落地循环器
      var timer2 = null;
      var t = 0;//角色身处高度
      var speed = 0;//坠落叠加速度
      var isOn = false;//是否往上飞
      var count = 0;
      var isGameOver = false;
      var dist = 0;
      var num = 0;


      gameBox.style.display = 'block';
      gameBox.addEventListener('touchend', function(){
        if(one){
          one = false;
          bgm.play();
          bgm.loop = true;
        }
      })
      function rd(min,max){//[min,max)
        return (min+Math.random()*(max-min))
      }
      function fail(){
        clearInterval(timer);
        clearInterval(timer2)
        timer = timer2 = null;
        isGameOver = true;
        $('.game-page-current').removeClass('game-page-current');
        $(pages).eq(2).addClass('game-page-current');
        $('#nl2').animate({transform:'translate3d(-50%, -100%, 0px) matrix(0.5, 0, 0, 0.5, 190, 1070)',opacity:1}, 2000, function(){
          $('#zn2').animate({transform:'translate3d(-50%, -100%, 0px) matrix(0.4, 0, 0, 0.4, 530, 840)',opacity:1}, 1000, function(){
            setTimeout(function(){
              $('#zn2').animate({transform:'translate3d(0, -100%, 0px) matrix(0.4, 0, 0, 0.4, 530, 840)',opacity:0}, 1000, function(){
                $('.res1').eq(1).text(dist);
                $('.res1').animate({opacity:1}, 600, function(){
                  $('.res2').animate({opacity:1}, 600, function(){
                    $('#tudi').css('display','block').animate({opacity:1}, 1000, function(){
                      $('.gztxBtn').eq(0).css('display','block');
                      $('.gztxBtn').eq(0).animate({opacity:1}, 400, function(){
                        $('.cxlgBtn').eq(0).css('display','block');
                        $('.cxlgBtn').eq(0).animate({opacity:1},400);
                      });
                    });
                  });
                })
              });
            }, 1000)
          });
        });
      }
      function rolefall(){
        clearInterval(timer);
        zlBgm.play();
        count = 20;
        timer = setInterval(function(){
          t = $(oRole).offset().top;
          if(t>=810 || t<=-200){
            fail();//游戏结束
          }else{
            count++;
            speed=(1/2)*10*Math.pow((0.03*count), 2);
            oRole.style.top = t+speed+'px';
          }
        }, 30);
      }
      

      //page1
      $('#title').animate({transform:'translate3d(-50%, -100%, 0) matrix(1, 0, 0, 1, 320, 410)'}, 600, function(){
        setTimeout(function(){
          $('#nl1').animate({transform:'translate3d(-50%, -100%, 0) matrix(1, 0, 0, 1, 190, 1040)'}, 1000, function(){
            $('#yd1').animate({transform:'translate3d(-50%, -100%, 0) matrix(1, 0, 0, 1, 512, 876)'}, 1000);
            $('#zn1').animate({transform:'translate3d(-50%, -100%, 0) matrix(1, 0, 0, 1, 540, 834)'}, 1000, function(){
              $('#yxgzBtn').css('display','block');
              $('#yxgzBtn').animate({opacity:1}, 400, function(){
                $('#ksyxBtn').css('display','block');
                $('#ksyxBtn').animate({opacity:1},400);
              });
            });
          });
        }, 400);
      });
      $('#yxgzBtn').on('tap', function(){//游戏规则
        $('#gameRule').css('display','block');
        $('#zxzxBtn').css('display','block');
      })
      $('#zxzxBtn').on('tap', function(){//在下知晓
        $('#gameRule').css('display','none');
        $(this).css('display','none');
      })
      $('#ksyxBtn').on('tap', function(){//开始游戏
        $('.game-page-current').removeClass('game-page-current');
        $(pages).eq(1).addClass('game-page-current');
        (function(){
          var stone = $('#stone').offset();
          var role = $('#role').offset();
          var cloud1 = $('#cloud1').offset();
          var cloud2 = $('#cloud2').offset();
          var hail1 = $('#hail1').offset();
          var hail2 = $('#hail2').offset();
          function rockfall(){
            if(isGameOver) return;
            setTimeout(function(){
              $('#stone').animate({top:'1040px',left:rd(80,180)+'px'}, rd(2000,5000), function(){
                $('#stone').css({top:'-100px',left:rd(260,400)+'px'});
                rockfall();
              });
              ysMsc.play();
            }, rd(5000,12000))
          }
          rockfall();
          function cloudmove(){
            if(isGameOver) return;
            setTimeout(function(){
              $('#cloud1').animate({left:rd(-400,-200)+'px'}, 6000, function(){
                $(this).css({left:rd(640,720)+'px',top:rd(100,600)+'px',display:'block'});
                cloudmove();
              })
              $('#cloud2').animate({left:rd(-300,-200)+'px'}, 3000, function(){
                $(this).css({left:rd(640,700)+'px',top:rd(640,810)+'px',display:'block'});
              })
            }, rd(3000,10000))
          }
          cloudmove();
          function hailmove(){
            if(isGameOver) return;
            setTimeout(function(){
              $('#hail1').animate({left:rd(-500,-360)+'px'}, 6000, function(){
                $(this).css({left:rd(640,770)+'px'});
                hailmove();
              })
              $('#hail2').animate({left:rd(-500,-200)+'px'}, 3500, function(){
                $(this).css({left:rd(640,660)+'px'});
              })
            }, rd(3000,5000));
          }
          hailmove();
          rolefall();
          timer2 = setInterval(function(){
            num++;
            if(num%30===0){
              dist = num/30;
              $('#jl').text('共飞行了'+dist+'米');
            }
            stone = $('#stone').offset();
            role = $('#role').offset();
            cloud1 = $('#cloud1').offset();
            cloud2 = $('#cloud2').offset();
            hail1 = $('#hail1').offset();
            hail2 = $('#hail2').offset();

            if( role.left+role.width-20>=stone.left && 
                role.top+role.height-30>=stone.top && 
                role.top+30<=stone.top+stone.height &&
                role.left+30<=stone.left+stone.width ){
              zdndBgm.play();
              fail();
            }
            if( role.left+role.width-20>=hail1.left && 
                role.top+role.height-30>=hail1.top && 
                role.top+30<=hail1.top+hail1.height &&
                role.left+30<=hail1.left+hail1.width ){
              zdndBgm.play();
              fail();
            }
            if( role.left+role.width-20>=hail2.left && 
                role.top+role.height-30>=hail2.top && 
                role.top+30<=hail2.top+hail2.height &&
                role.left+30<=hail2.left+hail2.width ){
              zdndBgm.play();
              fail();
            }
            if( role.left+role.width-20>=cloud1.left && 
                role.top+role.height-30>=cloud1.top && 
                role.top+30<=cloud1.top+cloud1.height &&
                role.left+30<=cloud1.left+cloud1.width ){
              $('#cloud1').css('display','none');
              dist=dist-10;
              num=dist*30;
              $('#jl').text('共飞行了'+dist+'米');
            }
            if( role.left+role.width-20>=cloud2.left && 
                role.top+role.height-30>=cloud2.top && 
                role.top+30<=cloud2.top+cloud2.height &&
                role.left+30<=cloud2.left+cloud2.width ){
              $('#cloud2').css('display','none');
              dist=dist-10;
              num=dist*30;
              $('#jl').text('共飞行了'+dist+'米');
            }

          }, 30);

        })()
      })

      //page2
      $('#game').on('tap', function(){
        if(isOn || isGameOver) return;
        isOn = true;
        clearInterval(timer);
        oRole.src = './images/2.png';
        scbMsc.play();
        $(oRole).animate({top:(t-80)+'px'}, 400, function(){
          isOn = false;
          oRole.src = './images/1.png';
          rolefall();
        });
      })
      
      
      //page3
      $('#tudi').on('tap', function(){//点我点我
        $('#tudijianghuw').css('display','block');
      })
      $('#tdy').on('tap',function(){//关闭讲话
        $('#tudijianghuw').css('display','none');
      })
      $('#fsmbBtn').on('tap', function(){//奉上秘宝
        $('.game-page-current').removeClass('game-page-current');
        $(pages).eq(3).addClass('game-page-current');
        bgm.pause();
        hjBgm.play();//获救音乐
        hjBgm.loop = true;
        setTimeout(function(){
          $('.res3').animate({opacity:1}, 600);
        }, 600);
      })

      //page4
      $('#wyymbBtn').on('tap', function(){
        window.open('http://web.fosu.edu.cn/lambda');
      })
      
      //page3、4
      $('.gztxBtn').on('tap', function(){//告知天下
        $('.share').css('display','block');
        $('.gztxBtn').remove();
        $('#wyymbBtn').css('transform','translate3d(-50%, -100%, 0) matrix(1, 0, 0, 1, 320, 880)')
      })
      $('.share').on('tap', function(){//转发
        $('.share').css('display','none');
      })
      $('.cxlgBtn').on('tap', function(){//重新来过
        window.location.reload();
      })

      
      $('.btn').on('tap', function(){
        btnMsc.play();
      })
      $('.tc').on('tap', function(){
        tcMsc.play();
      })

      
    }

    //进度加载
    function onprogress(){
      if(loadingDone){
        clearInterval(timer);
        loadingPage.parentNode.removeChild(loadingPage);
        gameView();
      }
      if(loadingText.innerHTML==='100') loadingDone=true;
      else{
        p = loadingText.innerHTML-0+4;
        loadingText.innerHTML = p+'';
        bar.style.width = (p)+'%';
      }
    }
    var timer = setInterval(onprogress, 100);

  </script>
</body>
</html>